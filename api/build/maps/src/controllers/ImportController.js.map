{"version":3,"sources":["src/controllers/ImportController.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA,6DAAkH;AAClH,6EAAsE;AACtE,6CAAwC;AACxC,+CAA0C;AAC1C,+CAA0C;AAM1C,IAAa,gBAAgB,GAA7B,MAAa,gBAAgB;IAE3B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;OA6BG;IAEG,YAAY,CAAuB,IAAS,EAChB,IAAW;;YAC3C,MAAM,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,CAAC;YACtD,OAAO,MAAM,eAAM,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;QAClE,CAAC;KAAA;IAED;;;;;;;;;;;;;;;;;;;;;;OAsBG;IAEG,aAAa,CAAuB,IAAS,EACd,QAAgB;;YACnD,MAAM,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,CAAC;YACvD,OAAO,iBAAO,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,WAAW,EAAE,QAAQ,CAAC,CAAC;QAClE,CAAC;KAAA;IAED;;;;;;;;;;;;;;;;;;;;;;;;;;;OA2BG;IAEG,UAAU,CAAuB,IAAS,EACd,QAAgB,EACf,SAAiB;;YAClD,MAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,CAAC;YACpD,OAAO,WAAI,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,QAAQ,EAAE,QAAQ,EAAE,SAAS,CAAC,CAAC;QACvE,CAAC;KAAA;CACF,CAAA;AAvEC;IADC,0BAAI,CAAC,SAAS,CAAC;IACI,WAAA,kCAAY,CAAC,MAAM,CAAC,CAAA;IACpB,WAAA,iCAAW,EAAE,CAAA;;;;oDAGhC;AA0BD;IADC,0BAAI,CAAC,kBAAkB,CAAC;IACJ,WAAA,kCAAY,CAAC,MAAM,CAAC,CAAA;IACpB,WAAA,2BAAK,CAAC,QAAQ,CAAC,CAAA;;;;qDAGnC;AA+BD;IADC,0BAAI,CAAC,wBAAwB,CAAC;IACb,WAAA,kCAAY,CAAC,MAAM,CAAC,CAAA;IACpB,WAAA,2BAAK,CAAC,QAAQ,CAAC,CAAA;IACf,WAAA,2BAAK,CAAC,SAAS,CAAC,CAAA;;;;kDAGjC;AAvGU,gBAAgB;IAH5B,oCAAc,CAAC,SAAS,CAAC;IACzB,+BAAS,CAAC,+BAAqB,CAAC;IAChC,gCAAU,CAAC,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;GACpB,gBAAgB,CAwG5B;AAxGY,4CAAgB","file":"../../../src/controllers/ImportController.js","sourcesContent":["import {Authorized, CurrentUser, JsonController, Param, Post, UploadedFile, UseBefore} from 'routing-controllers';\r\nimport passportJwtMiddleware from '../security/passportJwtMiddleware';\r\nimport {Course} from '../models/Course';\r\nimport {Lecture} from '../models/Lecture';\r\nimport {Unit} from '../models/units/Unit';\r\nimport {IUser} from '../../../shared/models/IUser';\r\n\r\n@JsonController('/import')\r\n@UseBefore(passportJwtMiddleware)\r\n@Authorized(['teacher', 'admin'])\r\nexport class ImportController {\r\n\r\n  /**\r\n   * @api {post} /api/import/course Import course\r\n   * @apiName PostImportCourse\r\n   * @apiGroup Import\r\n   * @apiPermission teacher\r\n   * @apiPermission admin\r\n   *\r\n   * @apiParam {Object} file Uploaded file.\r\n   * @apiParam {IUser} currentUser Currently logged in user.\r\n   *\r\n   * @apiSuccess {Course} course Imported course.\r\n   *\r\n   * @apiSuccessExample {json} Success-Response:\r\n   *     {\r\n   *         \"_id\": \"5ab2518b6a53b2463c44ef29\",\r\n   *         \"updatedAt\": \"2018-03-21T12:35:23.812Z\",\r\n   *         \"createdAt\": \"2018-03-21T12:35:23.803Z\",\r\n   *         \"name\": \"Test 101 (copy)\",\r\n   *         \"description\": \"Some course desc\",\r\n   *         \"courseAdmin\": \"5a037e6a60f72236d8e7c813\",\r\n   *         \"active\": false,\r\n   *         \"__v\": 1,\r\n   *         \"whitelist\": [],\r\n   *         \"enrollType\": \"whitelist\",\r\n   *         \"lectures\": [...],\r\n   *         \"students\": [],\r\n   *         \"teachers\": [],\r\n   *         \"hasAccessKey\": false\r\n   *     }\r\n   */\r\n  @Post('/course')\r\n  async importCourse(@UploadedFile('file') file: any,\r\n                     @CurrentUser() user: IUser) {\r\n    const courseDesc = JSON.parse(file.buffer.toString());\r\n    return await Course.schema.statics.importJSON(courseDesc, user);\r\n  }\r\n\r\n  /**\r\n   * @api {post} /api/import/lecture/:course Import lecture\r\n   * @apiName PostImportLecture\r\n   * @apiGroup Import\r\n   * @apiPermission teacher\r\n   * @apiPermission admin\r\n   *\r\n   * @apiParam {Object} file Uploaded file.\r\n   * @apiParam {String} courseId Course ID.\r\n   *\r\n   * @apiSuccess {Lecture} lecture Imported lecture.\r\n   *\r\n   * @apiSuccessExample {json} Success-Response:\r\n   *     {\r\n   *         \"_id\": \"5ab25342579fd5301c34e62f\",\r\n   *         \"updatedAt\": \"2018-03-21T12:42:42.392Z\",\r\n   *         \"createdAt\": \"2018-03-21T12:42:42.392Z\",\r\n   *         \"name\": \"Lecture One\",\r\n   *         \"description\": \"Some lecture desc\",\r\n   *         \"__v\": 0,\r\n   *         \"units\": []\r\n   *     }\r\n   */\r\n  @Post('/lecture/:course')\r\n  async importLecture(@UploadedFile('file') file: any,\r\n                      @Param('course') courseId: string) {\r\n    const lectureDesc = JSON.parse(file.buffer.toString());\r\n    return Lecture.schema.statics.importJSON(lectureDesc, courseId);\r\n  }\r\n\r\n  /**\r\n   * @api {post} /api/import/unit/:course/:lecture Import unit\r\n   * @apiName PostImportUnit\r\n   * @apiGroup Import\r\n   * @apiPermission teacher\r\n   * @apiPermission admin\r\n   *\r\n   * @apiParam {Object} file Uploaded file.\r\n   * @apiParam {String} courseId Course ID.\r\n   * @apiParam {String} lectureId Lecture ID.\r\n   *\r\n   * @apiSuccess {Unit} unit Imported unit.\r\n   *\r\n   * @apiSuccessExample {json} Success-Response:\r\n   *     {\r\n   *         \"__v\": 0,\r\n   *         \"updatedAt\": \"2018-03-21T12:50:36.628Z\",\r\n   *         \"createdAt\": \"2018-03-21T12:50:36.628Z\",\r\n   *         \"progressable\": false,\r\n   *         \"weight\": 0,\r\n   *         \"name\": \"First unit\",\r\n   *         \"description\": null,\r\n   *         \"markdown\": \"Welcome, this is the start\",\r\n   *         \"_course\": \"5ab2518b6a53b2463c44ef29\",\r\n   *         \"__t\": \"free-text\",\r\n   *         \"_id\": \"5ab2551c85b1ca402815e0b9\"\r\n   *     }\r\n   */\r\n  @Post('/unit/:course/:lecture')\r\n  async importUnit(@UploadedFile('file') file: any,\r\n                   @Param('course') courseId: string,\r\n                   @Param('lecture') lectureId: string) {\r\n    const unitDesc = JSON.parse(file.buffer.toString());\r\n    return Unit.schema.statics.importJSON(unitDesc, courseId, lectureId);\r\n  }\r\n}\r\n"]}