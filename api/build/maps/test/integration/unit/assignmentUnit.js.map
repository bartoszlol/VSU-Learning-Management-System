{"version":3,"sources":["test/integration/unit/assignmentUnit.ts"],"names":[],"mappings":"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","file":"../../../../test/integration/unit/assignmentUnit.js","sourcesContent":["import fs = require('fs');\r\nimport path = require('path');\r\n\r\nimport * as chai from 'chai';\r\nimport chaiHttp = require('chai-http');\r\nimport {Server} from '../../../src/server';\r\nimport {FixtureLoader} from '../../../fixtures/FixtureLoader';\r\nimport {JwtUtils} from '../../../src/security/JwtUtils';\r\nimport {User} from '../../../src/models/User';\r\nimport {Lecture} from '../../../src/models/Lecture';\r\nimport {Course} from '../../../src/models/Course';\r\nimport {FixtureUtils} from '../../../fixtures/FixtureUtils';\r\nimport {Unit} from '../../../src/models/units/Unit';\r\nimport {IAssignmentUnitModel} from '../../../src/models/units/AssignmentUnit';\r\nimport {IAssignment} from '../../../../shared/models/assignment/IAssignment';\r\nimport {IFile} from '../../../../shared/models/mediaManager/IFile';\r\nimport {File} from '../../../src/models/mediaManager/File';\r\n\r\nchai.use(chaiHttp);\r\nconst should = chai.should();\r\nconst app = new Server().app;\r\nconst BASE_URL = '/api/units';\r\nconst fixtureLoader = new FixtureLoader();\r\n\r\ndescribe(`AssignmentUnit ${BASE_URL}`, () => {\r\n  // Before each test we reset the database\r\n  beforeEach(async() => {\r\n    await fixtureLoader.load();\r\n  });\r\n\r\n  describe(`GET ${BASE_URL}`, () => {\r\n\r\n    it('should get an assignment unit', async () => {\r\n      const unit = await Unit.findOne({__t: 'assignment'});\r\n      const lecture = await Lecture.findOne({units: {$in: [unit._id]}});\r\n      const course = await Course.findOne({lectures: {$in: [lecture._id]}});\r\n\r\n      const courseAdmin = await User.findOne({_id: course.courseAdmin});\r\n\r\n      const res = await chai.request(app)\r\n        .get(BASE_URL + '/' + unit._id)\r\n        .set('Cookie', `token=${JwtUtils.generateToken(courseAdmin)}`)\r\n        .send({id: unit.id});\r\n\r\n      res.status.should.be.equal(200);\r\n    });\r\n  });\r\n\r\n  describe(`POST / DELETE / UPDATE ${BASE_URL}/:id/assignments`, () => {\r\n\r\n    it('should create an assignment in an assignment unit', async () => {\r\n      const unit = await Unit.findOne({__t: 'assignment'});\r\n      const lecture = await Lecture.findOne({units: {$in: [unit._id]}});\r\n      const course = await Course.findOne({lectures: {$in: [lecture._id]}});\r\n\r\n      const courseStudent = await FixtureUtils.getRandomStudentForCourse(course);\r\n\r\n      const res = await chai.request(app)\r\n        .post(`${BASE_URL}/${unit._id}/assignment`)\r\n        .set('Cookie', `token=${JwtUtils.generateToken(courseStudent)}`)\r\n        .send({id: unit.id});\r\n\r\n      res.status.should.be.equal(200);\r\n      res.body.user.should.be.equal(courseStudent._id.toString());\r\n    });\r\n\r\n\r\n    it('should update an assignment in an assignment unit', async () => {\r\n      const unit = <IAssignmentUnitModel>await Unit.findOne({__t: 'assignment'});\r\n      const lecture = await Lecture.findOne({units: {$in: [unit._id]}});\r\n      const course = await Course.findOne({lectures: {$in: [lecture._id]}});\r\n\r\n      const courseStudent = await FixtureUtils.getRandomStudentForCourse(course);\r\n\r\n      const assignment: IAssignment = {\r\n        _id: null,\r\n        files: [],\r\n        user: courseStudent._id,\r\n        submitted: false,\r\n        checked: -1,\r\n        submittedDate: new Date()\r\n      };\r\n\r\n      unit.assignments.push(assignment);\r\n      await unit.save();\r\n\r\n      assignment.submitted = true;\r\n\r\n      const res = await chai.request(app)\r\n        .put(`${BASE_URL}/${unit._id}/assignment`)\r\n        .set('Cookie', `token=${JwtUtils.generateToken(courseStudent)}`)\r\n        .send(assignment);\r\n\r\n      res.status.should.be.equal(200);\r\n    });\r\n\r\n    it('should delete an assignment in an assignment unit', async () => {\r\n      const unit = <IAssignmentUnitModel>await Unit.findOne({__t: 'assignment'});\r\n      const lecture = await Lecture.findOne({units: {$in: [unit._id]}});\r\n      const course = await Course.findOne({lectures: {$in: [lecture._id]}});\r\n\r\n\r\n      const courseStudent = await FixtureUtils.getRandomStudentForCourse(course);\r\n\r\n      const assignment: IAssignment = {\r\n        _id: null,\r\n        files: [],\r\n        user: courseStudent._id,\r\n        submitted: false,\r\n        checked: -1,\r\n        submittedDate: new Date()\r\n      };\r\n\r\n      unit.assignments.push(assignment);\r\n      await unit.save();\r\n\r\n      const res = await chai.request(app)\r\n        .del(`${BASE_URL}/${unit._id}/assignment`)\r\n        .set('Cookie', `token=${JwtUtils.generateToken(courseStudent)}`)\r\n        .send(assignment);\r\n\r\n      res.status.should.be.equal(200);\r\n\r\n      const unitAfter =  <IAssignmentUnitModel>await Unit.findById(unit._id.toString());\r\n      const hasBeenRemoved = unitAfter.assignments.length < unit.assignments.length;\r\n\r\n      hasBeenRemoved.should.be.true;\r\n    });\r\n  });\r\n\r\n  describe('Assignment file tests'/* `POST / DELETE / UPDATE ${BASE_URL}/:id/assignment/files`*/ , async () => {\r\n\r\n    it('should add a file to an assignment', async () => {\r\n\r\n      const unit = <IAssignmentUnitModel>await Unit.findOne({__t: 'assignment'});\r\n      const lecture = await Lecture.findOne({units: {$in: [unit._id]}});\r\n      const course = await Course.findOne({lectures: {$in: [lecture._id]}});\r\n\r\n      const courseStudent = await FixtureUtils.getRandomStudentForCourse(course);\r\n\r\n      const assignment: IAssignment = {\r\n        _id: null,\r\n        files: [],\r\n        user: courseStudent._id,\r\n        submitted: false,\r\n        checked: -1,\r\n        submittedDate: new Date()\r\n      };\r\n\r\n      unit.assignments.push(assignment);\r\n      await unit.save();\r\n\r\n        const res = await chai.request(app)\r\n          .put(`${BASE_URL}/${unit._id}/assignment/files`)\r\n          .attach('file', fs.readFileSync('fixtures/binaryData/testvideo.mp4'), 'testvideo.mp4')\r\n          .set('Cookie', `token=${JwtUtils.generateToken(courseStudent)}`);\r\n\r\n        res.status.should.be.equal(200);\r\n    });\r\n\r\n    it('should not add a file to an assignment if already has been submitted', async () => {\r\n\r\n      const unit = <IAssignmentUnitModel>await Unit.findOne({__t: 'assignment'});\r\n      const lecture = await Lecture.findOne({units: {$in: [unit._id]}});\r\n      const course = await Course.findOne({lectures: {$in: [lecture._id]}});\r\n\r\n      const courseStudent = await FixtureUtils.getRandomStudentForCourse(course);\r\n\r\n      const assignment: IAssignment = {\r\n        _id: null,\r\n        files: [],\r\n        user: courseStudent._id,\r\n        submitted: true,\r\n        checked: -1,\r\n        submittedDate: new Date()\r\n      };\r\n\r\n      unit.assignments.push(assignment);\r\n      await unit.save();\r\n\r\n      const res = await chai.request(app)\r\n        .put(`${BASE_URL}/${unit._id}/assignment/files`)\r\n        .attach('file', fs.readFileSync('fixtures/binaryData/small-image.jpg'), 'testvideo.mp4')\r\n        .set('Cookie', `token=${JwtUtils.generateToken(courseStudent)}`);\r\n\r\n      res.status.should.be.equal(400);\r\n    });\r\n\r\n    it('should download all files from an assignment', async () => {\r\n\r\n      const unit = <IAssignmentUnitModel>await Unit.findOne({__t: 'assignment'});\r\n      const lecture = await Lecture.findOne({units: {$in: [unit._id]}});\r\n      const course = await Course.findOne({lectures: {$in: [lecture._id]}});\r\n\r\n      const courseStudent = await FixtureUtils.getRandomStudentForCourse(course);\r\n      const courseTeacher = await FixtureUtils.getRandomTeacherForCourse(course);\r\n\r\n      fs.copyFileSync(\r\n        path.resolve('fixtures/binaryData/small-image.jpg'),\r\n        path.resolve('uploads/small-image.jpg')\r\n      );\r\n\r\n      const fileMetadata: IFile = new File({\r\n        name: 'small-image.jpg',\r\n        physicalPath: path.resolve('uploads/small-image.jpg'),\r\n        link: 'small-image.jpg',\r\n        size: 0,\r\n        mimeType: 'its-a-video'\r\n      });\r\n\r\n      const file = await new File(fileMetadata).save();\r\n\r\n      const assignment: IAssignment = {\r\n        _id: null,\r\n        user: courseStudent._id,\r\n        submitted: true,\r\n        files: [ file ],\r\n        checked: -1,\r\n        submittedDate: new Date()\r\n      };\r\n\r\n      unit.assignments.push(assignment);\r\n      await unit.save();\r\n\r\n      const res = await chai.request(app)\r\n        .get(`${BASE_URL}/${unit._id}/assignments/files`)\r\n        .set('Cookie', `token=${JwtUtils.generateToken(courseTeacher)}`)\r\n        .send();\r\n\r\n      res.status.should.be.equal(200);\r\n      fs.unlinkSync(path.resolve('uploads/small-image.jpg'));\r\n    });\r\n\r\n\r\n    it('should download files from a single assignment', async () => {\r\n\r\n      const unit = <IAssignmentUnitModel>await Unit.findOne({__t: 'assignment'});\r\n      const lecture = await Lecture.findOne({units: {$in: [unit._id]}});\r\n      const course = await Course.findOne({lectures: {$in: [lecture._id]}});\r\n\r\n      const courseStudent = await FixtureUtils.getRandomStudentForCourse(course);\r\n      const courseTeacher = await FixtureUtils.getRandomTeacherForCourse(course);\r\n\r\n      fs.copyFileSync(\r\n        path.resolve('fixtures/binaryData/small-image.jpg'),\r\n        path.resolve('uploads/small-image.jpg')\r\n      );\r\n\r\n      const fileMetadata: IFile = new File({\r\n        name: 'small-image.jpg',\r\n        physicalPath: path.resolve('uploads/small-image.jpg'),\r\n        link: 'small-image.jpg',\r\n        size: 0,\r\n        mimeType: 'its-a-video'\r\n      });\r\n\r\n      const file = await new File(fileMetadata).save();\r\n\r\n      const assignment: IAssignment = {\r\n        _id: null,\r\n        user: courseStudent._id,\r\n        submitted: true,\r\n        files: [ file ],\r\n        checked: -1,\r\n        submittedDate: new Date()\r\n      };\r\n\r\n      unit.assignments.push(assignment);\r\n      await unit.save();\r\n\r\n      const res = await chai.request(app)\r\n        .get(`${BASE_URL}/${unit._id}/assignments/${courseStudent._id}/files`)\r\n        .set('Cookie', `token=${JwtUtils.generateToken(courseTeacher)}`)\r\n        .send();\r\n\r\n      res.status.should.be.equal(200);\r\n      fs.unlinkSync(path.resolve('uploads/small-image.jpg'));\r\n    });\r\n  });\r\n});\r\n"]}